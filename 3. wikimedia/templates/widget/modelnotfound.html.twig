{% extends 'base.html.twig' %}

{% block title %}Monitorizaci√≥n Iniciada{% endblock %}

{% block body %}
    <style>
        /* --- CORRECCI√ìN DE ALTURA (Mantenida) --- */
        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            margin: 0;
            padding: 1rem;
            font-family: system-ui, -apple-system, "Segoe UI", Roboto;
            background: #FAFAFA;
            color: #1F2937;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        /* Contenedor principal que se estira */
        .main-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        /* --- ESTILOS VISUALES --- */
        @keyframes breath {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #10B981;
            border-radius: 50%;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        .technical-card {
            background: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 20px;
            text-align: center;

            /* Para llenar el hueco vertical */
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
    </style>

    <div class="main-wrapper">

        {# CABECERA #}
        <div class="flex justify-between items-center py-1">
            <div class="flex items-center gap-2">
                <div class="status-dot"></div>
                <p class="text-xs font-bold text-gray-500 uppercase tracking-wide">
                    Sistema Activo
                </p>
            </div>
            <span class="text-[10px] font-mono text-gray-400 bg-gray-100 px-2 py-1 rounded">
                ID: {{ 'now'|date('U')|slice(-6) }}
            </span>
        </div>

        {# TARJETA SUPERIOR (La raz√≥n t√©cnica) #}
        <div class="rounded-xl p-5 shadow-sm"
             style="background: #F8FAFC; border: 1px solid #E2E8F0;">
            <div class="flex items-start gap-3">
                <div style="font-size: 22px;">üìâ</div>
                <div>
                    <h3 style="font-size: 14px; font-weight: 700; color: #334155; margin: 0 0 4px 0;">
                        Volumen estad√≠stico insuficiente
                    </h3>
                    <p style="font-size: 13px; color: #64748B; line-height: 1.5; margin: 0;">
                        Este modelo espec√≠fico presenta una <b>baja rotaci√≥n de mercado</b> actualmente.
                    </p>
                </div>
            </div>

            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #E2E8F0;">
                <p style="font-size: 12px; color: #64748B; line-height: 1.4;">
                    Para garantizar la precisi√≥n, hemos pausado la valoraci√≥n autom√°tica hasta recopilar m√°s muestras.
                </p>
            </div>
        </div>

        {# INFO VEH√çCULO #}
        <div class="px-4 py-3 rounded-lg border border-gray-200 bg-white">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-[10px] text-gray-400 uppercase font-bold mb-1">Veh√≠culo catalogado</p>
                    <p class="text-sm font-semibold text-gray-800 leading-tight">
                        {{ brand|default('Marca') }} {{ model|default('Modelo') }}
                    </p>
                </div>
                {% if currentPrice %}
                    <div class="text-right">
                        <p class="text-[10px] text-gray-400 uppercase font-bold mb-1">Precio Actual</p>
                        <p class="text-sm font-mono text-gray-600">
                            {{ currentPrice|number_format(0, ',', '.') }} ‚Ç¨
                        </p>
                    </div>
                {% endif %}
            </div>
        </div>

        {# ZONA FINAL (Disculpa + Sugerencia) #}
        <div class="technical-card">
            <div style="flex-grow: 1; display:flex; flex-direction:column; justify-content:center;">
                <div style="font-size: 38px; margin-bottom: 12px; opacity: 0.6;">üìÇ</div>

                <h3 class="text-gray-800 font-bold text-sm mb-2">
                    Seguimiento iniciado
                </h3>

                <div class="space-y-3 px-2">
                    <p class="text-xs text-gray-500 leading-relaxed">
                        Sentimos no poder ofrecerte datos inmediatos. Estamos trabajando en ampliar nuestra base de datos para este coche.
                    </p>

                    <p class="text-xs text-blue-600 font-medium bg-blue-50 p-2 rounded border border-blue-100">
                        üí° Sugerencia: Prueba a consultar <b>otros modelos</b> mientras completamos este an√°lisis.
                    </p>
                </div>

                <div class="mt-4 flex justify-center">
                    <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded bg-gray-50 border border-gray-200">
                        <span style="width: 6px; height: 6px; background: #9CA3AF; border-radius: 50%; animation: breath 2s infinite;"></span>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        window.parent.postMessage({
            type: 'PRICE_STATUS',
            status: 'monitoring',
            color: 'gray'
        }, '*');
    </script>
{% endblock %}
