<turbo-stream action="prepend" target="wikimedia-stream">
    <template>
        {# 1. Definir qu√© pas√≥ (La Acci√≥n) #}
        {% set action_badge %}
            {% if type == 'new' %}
                <div class="badge badge-success gap-2 font-bold text-white">‚ú® NUEVO</div>
            {% elseif type == 'log' %}
                <div class="badge badge-warning gap-2 font-bold">‚ö†Ô∏è LOG</div>
            {% elseif type == 'categorize' %}
                <div class="badge badge-info gap-2 font-bold">üè∑Ô∏è CAT</div>
            {% elseif namespace != 0 %}
                <div class="badge badge-neutral gap-2">üí¨ DISCUSI√ìN</div>
            {% else %}
                <div class="badge badge-ghost gap-2">‚úèÔ∏è EDICI√ìN</div>
            {% endif %}
        {% endset %}

        {# 2. Definir el impacto visual (Bordes) #}
        {% set border_class %}
            {% if type == 'new' %}border-l-success
            {% elseif diffSize < -500 %}border-l-error
            {% elseif diffSize > 500 %}border-l-info
            {% else %}border-l-base-300{% endif %}
        {% endset %}

        <div class="card card-compact bg-base-100 shadow-sm mb-2 border-l-8 {{ border_class }} fade-in-down group hover:bg-base-200 transition-colors">
            <div class="card-body p-3">

                {# CABECERA: Acci√≥n | Wiki | T√≠tulo #}
                <div class="flex items-center gap-2 mb-1">
                    {{ action_badge }}

                    <span class="badge badge-outline text-xs opacity-50">{{ wiki }}</span>

                    <a href="{{ url }}" target="_blank" class="link link-hover font-bold text-base text-primary truncate flex-1">
                        {{ title }}
                    </a>

                    <div class="text-xs font-mono opacity-50">{{ timestamp|date('H:i:s') }}</div>
                </div>

                {# CUERPO: El resumen de lo que pas√≥ #}
                <div class="flex items-start gap-3 pl-1">
                    {# Icono de usuario #}
                    <div class="tooltip" data-tip="{{ user }}">
                        <div class="avatar placeholder">
                            <div class="bg-neutral-focus text-neutral-content rounded-full w-8 h-8">
                                <span class="text-xs">{{ bot ? 'ü§ñ' : 'üë§' }}</span>
                            </div>
                        </div>
                    </div>

                    {# EL CONTENIDO: Aqu√≠ explicamos qu√© se edit√≥ #}
                    <div class="flex-1 min-w-0">
                        {# Si hay comentario, lo mostramos como una cita o bloque de c√≥digo #}
                        {% if comment %}
                            <div class="text-sm italic opacity-80 border-l-2 border-base-300 pl-2 text-base-content/80 break-words">
                                "{{ comment|striptags }}"
                            </div>
                        {% else %}
                            <div class="text-sm opacity-40 italic">Sin descripci√≥n de cambios...</div>
                        {% endif %}

                        {# M√©tricas num√©ricas #}
                        <div class="mt-1 flex gap-2 text-xs">
                             <span class="font-bold {{ diffSize > 0 ? 'text-success' : 'text-error' }}">
                                {{ diffSize > 0 ? '+' : '' }}{{ diffSize }} bytes
                             </span>
                            {% if user %}
                                <span class="opacity-50">por {{ user|slice(0, 20) }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </template>
</turbo-stream>
